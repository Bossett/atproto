{
  "lexicon": 1,
  "id": "tools.ozone.defs",
  "defs": {
    "modEventView": {
      "type": "object",
      "required": [
        "id",
        "event",
        "subject",
        "subjectBlobCids",
        "createdBy",
        "createdAt"
      ],
      "properties": {
        "id": { "type": "integer" },
        "event": {
          "type": "union",
          "refs": [
            "#modEventTakedown",
            "#modEventReverseTakedown",
            "#modEventComment",
            "#modEventReport",
            "#modEventLabel",
            "#modEventAcknowledge",
            "#modEventEscalate",
            "#modEventMute",
            "#modEventEmail",
            "#modEventResolveAppeal",
            "#modEventDivert"
          ]
        },
        "subject": {
          "type": "union",
          "refs": ["#repoRef", "com.atproto.repo.strongRef"]
        },
        "subjectBlobCids": { "type": "array", "items": { "type": "string" } },
        "createdBy": { "type": "string", "format": "did" },
        "createdAt": { "type": "string", "format": "datetime" },
        "creatorHandle": { "type": "string" },
        "subjectHandle": { "type": "string" }
      }
    },
    "modEventViewDetail": {
      "type": "object",
      "required": [
        "id",
        "event",
        "subject",
        "subjectBlobs",
        "createdBy",
        "createdAt"
      ],
      "properties": {
        "id": { "type": "integer" },
        "event": {
          "type": "union",
          "refs": [
            "#modEventTakedown",
            "#modEventReverseTakedown",
            "#modEventComment",
            "#modEventReport",
            "#modEventLabel",
            "#modEventAcknowledge",
            "#modEventEscalate",
            "#modEventMute",
            "#modEventEmail",
            "#modEventResolveAppeal",
            "#modEventDivert"
          ]
        },
        "subject": {
          "type": "union",
          "refs": [
            "#repoView",
            "#repoViewNotFound",
            "#recordView",
            "#recordViewNotFound"
          ]
        },
        "subjectBlobs": {
          "type": "array",
          "items": { "type": "ref", "ref": "#blobView" }
        },
        "createdBy": { "type": "string", "format": "did" },
        "createdAt": { "type": "string", "format": "datetime" }
      }
    },
    "subjectStatusView": {
      "type": "object",
      "required": ["id", "subject", "createdAt", "updatedAt", "reviewState"],
      "properties": {
        "id": { "type": "integer" },
        "subject": {
          "type": "union",
          "refs": ["#repoRef", "com.atproto.repo.strongRef"]
        },
        "subjectBlobCids": {
          "type": "array",
          "items": { "type": "string", "format": "cid" }
        },
        "subjectRepoHandle": { "type": "string" },
        "updatedAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp referencing when the last update was made to the moderation status of the subject"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp referencing the first moderation status impacting event was emitted on the subject"
        },
        "reviewState": {
          "type": "ref",
          "ref": "#subjectReviewState"
        },
        "comment": {
          "type": "string",
          "description": "Sticky comment on the subject."
        },
        "muteUntil": {
          "type": "string",
          "format": "datetime"
        },
        "lastReviewedBy": {
          "type": "string",
          "format": "did"
        },
        "lastReviewedAt": {
          "type": "string",
          "format": "datetime"
        },
        "lastReportedAt": {
          "type": "string",
          "format": "datetime"
        },
        "lastAppealedAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp referencing when the author of the subject appealed a moderation action"
        },
        "takendown": {
          "type": "boolean"
        },
        "appealed": {
          "type": "boolean",
          "description": "True indicates that the a previously taken moderator action was appealed against, by the author of the content. False indicates last appeal was resolved by moderators."
        },
        "suspendUntil": {
          "type": "string",
          "format": "datetime"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "subjectReviewState": {
      "type": "string",
      "knownValues": [
        "#reviewOpen",
        "#reviewEscalated",
        "#reviewClosed",
        "#reviewNone"
      ]
    },
    "reviewOpen": {
      "type": "token",
      "description": "Moderator review status of a subject: Open. Indicates that the subject needs to be reviewed by a moderator"
    },
    "reviewEscalated": {
      "type": "token",
      "description": "Moderator review status of a subject: Escalated. Indicates that the subject was escalated for review by a moderator"
    },
    "reviewClosed": {
      "type": "token",
      "description": "Moderator review status of a subject: Closed. Indicates that the subject was already reviewed and resolved by a moderator"
    },
    "reviewNone": {
      "type": "token",
      "description": "Moderator review status of a subject: Unnecessary. Indicates that the subject does not need a review at the moment but there is probably some moderation related metadata available for it"
    },
    "modEventTakedown": {
      "type": "object",
      "description": "Take down a subject permanently or temporarily",
      "properties": {
        "comment": {
          "type": "string"
        },
        "durationInHours": {
          "type": "integer",
          "description": "Indicates how long the takedown should be in effect before automatically expiring."
        }
      }
    },
    "modEventReverseTakedown": {
      "type": "object",
      "description": "Revert take down action on a subject",
      "properties": {
        "comment": {
          "type": "string",
          "description": "Describe reasoning behind the reversal."
        }
      }
    },
    "modEventResolveAppeal": {
      "type": "object",
      "description": "Resolve appeal on a subject",
      "properties": {
        "comment": {
          "type": "string",
          "description": "Describe resolution."
        }
      }
    },
    "modEventComment": {
      "type": "object",
      "description": "Add a comment to a subject",
      "required": ["comment"],
      "properties": {
        "comment": {
          "type": "string"
        },
        "sticky": {
          "type": "boolean",
          "description": "Make the comment persistent on the subject"
        }
      }
    },
    "modEventReport": {
      "type": "object",
      "description": "Report a subject",
      "required": ["reportType"],
      "properties": {
        "comment": {
          "type": "string"
        },
        "reportType": {
          "type": "ref",
          "ref": "com.atproto.moderation.defs#reasonType"
        }
      }
    },
    "modEventLabel": {
      "type": "object",
      "description": "Apply/Negate labels on a subject",
      "required": ["createLabelVals", "negateLabelVals"],
      "properties": {
        "comment": {
          "type": "string"
        },
        "createLabelVals": {
          "type": "array",
          "items": { "type": "string" }
        },
        "negateLabelVals": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "modEventAcknowledge": {
      "type": "object",
      "properties": {
        "comment": { "type": "string" }
      }
    },
    "modEventEscalate": {
      "type": "object",
      "properties": {
        "comment": { "type": "string" }
      }
    },
    "modEventMute": {
      "type": "object",
      "description": "Mute incoming reports on a subject",
      "required": ["durationInHours"],
      "properties": {
        "comment": { "type": "string" },
        "durationInHours": {
          "type": "integer",
          "description": "Indicates how long the subject should remain muted."
        }
      }
    },
    "modEventUnmute": {
      "type": "object",
      "description": "Unmute action on a subject",
      "properties": {
        "comment": {
          "type": "string",
          "description": "Describe reasoning behind the reversal."
        }
      }
    },
    "modEventEmail": {
      "type": "object",
      "description": "Keep a log of outgoing email to a user",
      "required": ["subjectLine"],
      "properties": {
        "subjectLine": {
          "type": "string",
          "description": "The subject line of the email sent to the user."
        },
        "comment": {
          "type": "string",
          "description": "Additional comment about the outgoing comm."
        }
      }
    },
    "modEventTag": {
      "type": "object",
      "description": "Add/Remove a tag on a subject",
      "required": ["add", "remove"],
      "properties": {
        "add": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Tags to be added to the subject. If already exists, won't be duplicated."
        },
        "remove": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Tags to be removed to the subject. Ignores a tag If it doesn't exist, won't be duplicated."
        },
        "comment": {
          "type": "string",
          "description": "Additional comment about added/removed tags."
        }
      }
    },
    "modEventDivert": {
      "type": "object",
      "description": "Divert a record's blobs to a 3rd party service for further scanning/tagging",
      "properties": {
        "comment": { "type": "string" }
      }
    },
    "communicationTemplateView": {
      "type": "object",
      "required": [
        "id",
        "name",
        "contentMarkdown",
        "disabled",
        "lastUpdatedBy",
        "createdAt",
        "updatedAt"
      ],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string", "description": "Name of the template." },
        "subject": {
          "type": "string",
          "description": "Content of the template, can contain markdown and variable placeholders."
        },
        "contentMarkdown": {
          "type": "string",
          "description": "Subject of the message, used in emails."
        },
        "disabled": { "type": "boolean" },
        "lastUpdatedBy": {
          "type": "string",
          "format": "did",
          "description": "DID of the user who last updated the template."
        },
        "createdAt": { "type": "string", "format": "datetime" },
        "updatedAt": { "type": "string", "format": "datetime" }
      }
    }
  }
}
